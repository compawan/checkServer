<!DOCTYPE html>
<html>
  <head>
    <title>Remote Control with ID</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  </head>
  <body>
    <h2>Remote Control</h2>
    <input id="idBox" placeholder="Enter device ID" />
    <button id="connectBtn">Connect</button>
    <br><br>
    <img id="screen" style="max-width:100%; display:none;" />

    <script>
      const socket = io("https://checkserver-rmqt.onrender.com"); // or localhost

      const img = document.getElementById("screen");
      const input = document.getElementById("idBox");
      const button = document.getElementById("connectBtn");

      let currentId = null;

      button.addEventListener("click", () => {
        const enteredId = input.value.trim();
        if (enteredId) {
          currentId = enteredId;

          socket.emit("viewer_connect", { id: enteredId });

          img.src = `http://checkserver-rmqt.onrender.com/stream?id=${enteredId}`;
          img.style.display = "block";
        }
      });

      img.addEventListener("click", e => {
        if (!currentId) return;

        const x = e.offsetX;
        const y = e.offsetY;

        socket.emit("touch", {
          id: currentId,
          type: "tap",
          x,
          y
        });
      });

      document.addEventListener("keydown", e => {
        if (!currentId) return;
        socket.emit("key", {
          id: currentId,
          key: e.key,
          code: e.code,
          keyCode: e.keyCode
        });
      });
    </script>
  </body>
</html>
